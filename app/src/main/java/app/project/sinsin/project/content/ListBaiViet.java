package app.project.sinsin.project.content;

import android.content.Intent;
import android.os.Bundle;
import android.support.v7.app.AppCompatActivity;
import android.support.v7.widget.SearchView;
import android.support.v7.widget.Toolbar;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.widget.AdapterView;
import android.widget.ListView;

import java.util.ArrayList;
import java.util.Locale;

import app.project.sinsin.project.R;
import app.project.sinsin.project.dao.BaiVietDao;
import app.project.sinsin.project.dao.DanhMucChucNangDao;
import app.project.sinsin.project.model.BaiViet;

public class ListBaiViet extends AppCompatActivity implements SearchView.OnQueryTextListener {

    SearchView searchView;
    BaiVietAdapter baiVietAdapter;
    ListView listView;
    ArrayList<BaiViet> baiViets;
    BaiVietDao baiVietDao;
    int maDanhMuc;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_list_bai_viet);

        Intent intent = getIntent();
        maDanhMuc = intent.getIntExtra("maDanhMuc", 0);
        baiVietDao = new BaiVietDao();
        DanhMucChucNangDao danhMucChucNangDao = new DanhMucChucNangDao();

        baiViets = baiVietDao.dsDanhMucChucNang(maDanhMuc);

        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
        toolbar = (Toolbar) findViewById(R.id.toolbar);
        toolbar.setTitle(danhMucChucNangDao.danhMucChucNang(maDanhMuc).getTenDanhMuc());
        setSupportActionBar(toolbar);
        toolbar.setNavigationOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                onBackPressed();
            }
        });
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);
        getSupportActionBar().setDisplayShowHomeEnabled(true);

        listView = (ListView) findViewById(R.id.listBaiViet);
        baiVietAdapter = new BaiVietAdapter(this, R.layout.activity_list_bai_viet, baiViets);
        listView.setAdapter(baiVietAdapter);
        //xlsk nhan vao item
        if (maDanhMuc == 1) {
            listView.setOnItemClickListener(new AdapterView.OnItemClickListener() {
                @Override

                public void onItemClick(AdapterView<?> parent, View view, int position, long id) {
                    Intent intent = new Intent(ListBaiViet.this, Activity_BaiViet.class);
                    intent.putExtra("maBaiViet", baiViets.get(position).getMaBaiViet());
                    startActivity(intent);
                }
            });
        } else {
            listView.setOnItemClickListener(new AdapterView.OnItemClickListener() {
                @Override

                public void onItemClick(AdapterView<?> parent, View view, int position, long id) {
                    Intent intent = new Intent(ListBaiViet.this, ChiTietBaiViet.class);

                    intent.putExtra("maBaiViet", baiViets.get(position).getMaBaiViet());
                    startActivity(intent);
                }
            });
        }
        searchView = (SearchView) findViewById(R.id.search_view);
    }

    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        // Inflate the menu; this adds items to the action bar if it is present.
        // thêm search vào vào action bar
        getMenuInflater().inflate(R.menu.search_view, menu);
        MenuItem itemSearch = menu.findItem(R.id.search_view);
        searchView = (SearchView) itemSearch.getActionView();
        //set OnQueryTextListener cho search view để thực hiện search theo text
        searchView.setOnQueryTextListener(this);
        return true;
    }

    @Override
    public boolean onQueryTextSubmit(String query) {
        return true;
    }

    @Override
    public boolean onQueryTextChange(String newText) {
        newText = newText.toLowerCase(Locale.getDefault());
        ArrayList<BaiViet> list = baiVietDao.dsDanhMucChucNang(maDanhMuc);
        baiViets.clear();
        if (newText.length() == 0) {
            baiViets.addAll(list);
        } else {
            for (BaiViet baiViet : list) {
                if (baiViet.getTieuDe().toLowerCase(Locale.getDefault()).contains(newText)) {
                    baiViets.add(baiViet);
                }

            }
            if (baiViets.size() == 0) {
                BaiViet baiViet = new BaiViet();
                baiViet.setTieuDe("Không tìm thấy kết quả tìm kiếm");
                byte[] hinhDaiDien = {-1,-40,-1,-37,0,67,0,8,6,6,7,6,5,8,7,7,7,9,9,8,10,12,20,13,12,11,11,12,25,18,19,15,20,29,26,31,30,29,26,28,28,32,36,46,39,32,34,44,35,28,28,40,55,41,44,48,49,52,52,52,31,39,57,61,56,50,60,46,51,52,50,-1,-37,0,67,1,9,9,9,12,11,12,24,13,13,24,50,33,28,33,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,-1,-64,0,20,8,0,-38,0,-60,4,1,34,0,2,17,1,3,17,1,4,34,0,-1,-60,0,31,0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,-1,-60,0,-75,16,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125,1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,-127,-111,-95,8,35,66,-79,-63,21,82,-47,-16,36,51,98,114,-126,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,-125,-124,-123,-122,-121,-120,-119,-118,-110,-109,-108,-107,-106,-105,-104,-103,-102,-94,-93,-92,-91,-90,-89,-88,-87,-86,-78,-77,-76,-75,-74,-73,-72,-71,-70,-62,-61,-60,-59,-58,-57,-56,-55,-54,-46,-45,-44,-43,-42,-41,-40,-39,-38,-31,-30,-29,-28,-27,-26,-25,-24,-23,-22,-15,-14,-13,-12,-11,-10,-9,-8,-7,-6,-1,-60,0,31,1,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,-1,-60,0,-75,17,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119,0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,-127,8,20,66,-111,-95,-79,-63,9,35,51,82,-16,21,98,114,-47,10,22,36,52,-31,37,-15,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,-126,-125,-124,-123,-122,-121,-120,-119,-118,-110,-109,-108,-107,-106,-105,-104,-103,-102,-94,-93,-92,-91,-90,-89,-88,-87,-86,-78,-77,-76,-75,-74,-73,-72,-71,-70,-62,-61,-60,-59,-58,-57,-56,-55,-54,-46,-45,-44,-43,-42,-41,-40,-39,-38,-30,-29,-28,-27,-26,-25,-24,-23,-22,-14,-13,-12,-11,-10,-9,-8,-7,-6,-1,-38,0,14,4,1,0,2,17,3,17,4,0,0,63,0,-9,-62,121,-93,52,30,-76,-108,8,-9,-6,40,-94,-105,52,102,-110,-118,0,40,-94,-118,92,-47,-102,74,40,0,-94,-118,41,115,70,105,40,-96,2,-118,40,-91,-51,25,-92,-94,-128,10,40,-94,-105,52,102,-110,-118,0,40,-94,-118,92,-47,-102,74,40,0,-94,-118,41,115,70,105,40,-96,2,-118,40,-96,-11,31,95,74,92,-46,81,64,5,20,81,75,-102,51,73,69,0,20,81,69,46,126,-108,103,-4,-30,-110,-118,0,40,-94,-118,92,-47,-102,74,40,0,-94,-118,41,-35,-123,20,118,20,80,1,69,20,82,26,74,83,73,64,5,20,81,69,20,81,64,5,20,81,69,20,82,103,-97,106,0,40,-94,-118,90,40,-49,36,81,-102,0,40,-94,-118,40,-94,-118,0,40,-94,-118,40,-94,-118,0,40,-94,-118,40,-94,-118,0,40,-94,-118,40,-94,-118,0,40,-94,-118,40,-94,-118,0,40,-94,-118,40,-94,-118,0,40,-94,-118,40,-94,-118,0,40,-94,-118,40,-94,-118,0,40,-94,-118,112,-24,40,-96,116,20,80,1,69,20,82,30,-76,-108,-89,-83,37,0,20,81,69,20,81,71,90,0,40,-94,-118,67,73,73,-98,73,-92,38,-112,-62,-118,40,-89,102,-105,-75,71,-70,-108,30,-108,0,81,69,20,-16,120,-91,-90,-114,-76,-17,122,98,10,40,-94,-118,40,-94,-128,10,40,-94,-118,40,-94,-128,10,40,-94,-118,40,-94,-128,10,40,-94,-118,40,-94,-128,10,40,-94,-118,40,-94,-128,10,40,-94,-118,40,-94,-128,10,40,-94,-118,40,-94,-128,10,40,-94,-99,-40,81,64,-24,40,-96,2,-118,40,-92,52,-108,-90,-110,-128,10,40,-94,-118,8,-94,-118,0,40,-94,-118,99,123,118,-19,76,62,-75,33,2,-104,83,-116,-12,30,-12,-122,20,81,69,71,78,25,45,74,35,-7,51,-34,-108,41,3,-125,64,5,20,81,79,28,10,119,61,15,90,96,-30,-100,7,-25,76,2,-118,40,-91,-94,-118,40,16,81,69,20,81,69,20,0,81,69,20,81,69,20,0,81,69,20,81,69,20,0,81,69,20,81,69,20,0,81,69,20,81,69,20,0,81,69,20,81,69,20,0,81,69,20,-31,-48,81,64,-23,69,0,20,81,69,33,-92,-91,61,105,59,-48,1,69,20,81,70,40,-94,-128,10,40,-94,-112,-127,-114,-108,-127,125,121,-10,-89,81,64,5,20,81,69,49,65,10,59,-113,67,79,61,-23,7,65,72,2,-118,40,-93,-98,-64,1,75,-118,40,-90,1,69,20,81,69,20,80,1,69,20,81,69,20,80,1,69,20,81,69,20,80,1,69,20,81,69,20,80,1,69,20,81,69,20,80,1,69,20,81,69,20,80,1,69,20,81,69,20,80,1,69,20,83,-121,65,69,38,112,5,20,0,81,69,20,26,79,74,83,73,-42,-128,10,40,-94,-118,41,51,-40,-46,-48,1,69,20,81,69,20,80,1,69,20,82,55,97,-21,75,72,57,59,-65,42,90,0,40,-94,-118,40,-94,-118,0,40,-94,-118,40,-94,-118,0,40,-94,-118,40,-94,-118,0,40,-94,-118,40,-94,-118,0,40,-94,-118,40,-94,-118,0,40,-94,-118,40,-94,-118,0,40,-94,-118,40,-94,-118,0,40,-94,-118,41,14,71,122,90,105,-50,104,0,-94,-118,41,-37,-120,3,-102,41,-116,122,81,72,97,69,20,84,-121,-83,37,41,-21,73,76,65,69,20,81,69,20,80,1,69,20,81,72,126,99,-114,-35,-24,39,-80,-21,74,6,5,0,20,81,69,20,81,69,0,20,81,69,20,81,69,0,20,81,69,20,81,69,0,20,81,69,20,81,69,0,20,81,69,20,81,69,0,20,81,69,20,81,69,0,20,81,69,20,81,69,0,20,81,69,20,81,69,0,20,81,69,6,-104,70,41,-12,-122,-127,-123,20,81,81,-79,35,31,74,41,-60,28,15,-91,20,-128,40,-94,-118,-112,-46,82,-102,74,98,10,40,-94,-118,58,81,72,-35,49,-21,64,5,20,81,64,29,-49,83,75,69,20,0,81,69,20,81,69,20,0,81,69,20,81,69,20,0,81,69,20,81,69,20,0,81,69,20,81,69,20,0,81,69,20,26,5,20,99,-97,106,0,40,-94,-118,40,-94,-118,0,40,-94,-118,40,-94,-118,0,40,-94,-118,40,-94,-126,123,14,104,0,-94,-118,40,-94,-114,104,-96,2,-118,40,-91,-64,32,100,81,74,58,10,40,0,-94,-118,41,15,90,74,83,-42,-110,-128,10,40,-94,-118,67,-9,-123,45,33,-22,15,-67,0,20,81,69,45,20,81,64,5,20,81,69,20,81,64,5,20,81,69,20,81,64,5,20,81,69,20,81,64,5,20,81,69,20,81,64,5,20,81,69,20,81,64,5,20,81,69,20,81,64,5,20,81,69,20,81,64,5,20,81,69,0,98,-118,40,0,-94,-118,40,-94,-118,40,0,-94,-118,41,-61,-96,-94,-114,-62,-118,0,40,-94,-118,67,73,74,105,40,0,-94,-118,40,-96,-118,40,-96,2,-118,40,-96,122,30,-76,82,17,-36,117,-91,-96,2,-118,40,-94,-118,40,-96,2,-118,40,-94,-118,40,-96,2,-118,40,-94,-118,40,-96,2,-118,40,-94,-118,41,15,20,0,81,69,20,-76,83,115,-51,40,57,-96,2,-118,40,-91,-94,-118,40,0,-94,-118,40,-94,-118,40,0,-94,-118,40,-94,-118,40,0,-94,-118,40,-91,-92,-94,-128,10,40,-94,-100,58,81,71,97,69,0,20,81,69,33,-21,73,74,122,-46,80,1,69,20,81,69,20,80,1,69,20,81,69,20,80,1,69,20,81,69,20,80,1,69,20,81,69,20,80,1,69,20,81,69,20,80,1,69,20,81,-21,77,99,-46,-100,106,41,14,5,12,97,69,20,81,-102,122,-97,74,-124,30,-11,50,-28,-116,10,72,2,-118,40,-89,81,69,20,-60,20,81,69,20,81,69,0,20,81,69,20,81,69,0,20,81,69,20,81,69,0,20,81,69,56,116,20,80,58,10,40,0,-94,-118,41,13,37,41,-21,73,64,5,20,81,69,20,81,64,5,20,81,69,20,81,64,5,20,81,69,20,81,64,5,20,81,69,20,81,64,5,20,81,69,20,81,64,5,20,81,69,53,-105,61,71,-27,78,-94,-128,10,40,-94,-93,88,-105,-112,106,65,-64,-64,-30,-109,-8,-66,-76,-76,0,81,69,20,81,69,20,0,81,69,20,81,69,20,0,81,69,20,81,69,20,0,81,69,20,81,69,20,0,81,69,20,-18,-62,-118,7,65,69,0,20,81,69,33,-21,73,74,105,40,0,-94,-118,40,-94,-118,40,0,-94,-118,40,-94,-118,40,0,-94,-118,40,-94,-118,40,0,-94,-118,40,-94,-118,40,0,-94,-118,40,-94,-118,40,0,-94,-118,40,-94,-118,40,0,-94,-118,40,35,35,-34,-128,114,61,-24,-92,60,28,-2,116,0,81,69,20,-76,81,69,0,20,81,69,20,81,69,0,20,81,69,20,81,69,0,20,81,69,20,81,69,0,20,81,69,59,-80,-94,-127,-48,81,64,5,20,81,72,122,-46,83,-77,70,104,0,-94,-118,41,-76,82,-28,-46,-26,-128,10,40,-94,-101,69,59,52,102,-128,10,40,-94,-101,69,59,52,100,-48,1,69,20,83,104,57,29,-77,78,-49,20,102,-128,10,40,-94,-103,-100,-10,52,-76,-20,-47,-98,104,0,-94,-118,41,-76,83,-77,73,-109,-21,64,5,20,81,73,69,59,38,-116,-48,1,69,20,83,23,-127,-113,74,90,50,119,117,-19,75,-109,64,-62,-118,40,-92,-94,-99,-102,76,-97,90,4,20,81,69,37,20,-20,-47,-102,0,40,-94,-118,109,20,-30,77,38,77,0,20,81,69,40,-24,40,-91,-94,-128,10,40,-94,-65,-1,-39};
                baiViet.setMaBaiViet(0);
                baiViet.setAnhDaiDien(hinhDaiDien);
                baiViets.add(baiViet);
            }
        }
        baiVietAdapter.notifyDataSetChanged();
        return false;
    }
}
